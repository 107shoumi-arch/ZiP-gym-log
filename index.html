<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ZiP TACTICAL LOG /// v33</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  /* === ESPORTS THEME V30 (STYLE UNTOUCHED) === */
  :root {
    --bg: #121212;
    --card: #1e1e1e;
    --border: #333333;
    --text-main: #e0e0e0;
    --text-sub: #888888;
    --accent: #6b8e23; /* Military Green */
    --warn: #a63737;    /* Brick Red */
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Roboto Mono', monospace;
    margin: 0; padding: 1rem; 
    padding-bottom: 220px; 
    padding-top: env(safe-area-inset-top);
    background-color: var(--bg); color: var(--text-main); 
    display: flex; justify-content: center;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
  }
  body.lock-scroll { overflow: hidden; }

  .shell { width: 100%; max-width: 600px; }

  h1 { 
    font-size: 1.6rem; text-align: center; margin: 10px 0 1.5rem; 
    letter-spacing: 2px; color: var(--text-sub); font-weight: 700;
    border-bottom: 2px solid var(--accent); display: block; width: 100%; padding-bottom: 10px;
    line-height: 1.3;
  }
  
  section {
    background: var(--card); border: 1px solid var(--border); border-radius: 8px;
    margin-bottom: 1.2rem; padding: 1.2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  }
  
  h2 { 
    font-size: 0.95rem; margin: 0 0 15px 0; display: flex; justify-content: space-between; align-items: center;
    color: var(--text-main); font-weight: 600; border-left: 4px solid var(--accent); padding-left: 12px; letter-spacing: 1px;
  }
  h2 small { font-size: 0.75rem; color: var(--text-sub); font-weight: 400; }

  label { 
    display: block; font-size: 0.75rem; color: var(--text-sub); margin-bottom: 5px; 
    font-family: 'Roboto Mono'; 
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
  }
  .sub-label { font-size: 0.85rem; color: var(--accent); margin-top: 20px; margin-bottom: 8px; display:block; font-weight:bold; border-bottom: 1px dashed #333; padding-bottom: 4px; }

  input, select, textarea {
    width: 100%; background: #181818; border: 1px solid #444; color: var(--text-main);
    padding: 0 10px; height: 45px; line-height: 45px;
    font-size: 15px; margin-bottom: 5px; border-radius: 4px; transition: 0.2s; font-family: 'Roboto Mono';
    appearance: none; -webkit-appearance: none;
    min-width: 0;
  }
  input:focus, select:focus, textarea:focus { border-color: var(--accent); background: #222; }
  input[type="date"], input[type="time"] { display: flex; align-items: center; padding-top: 2px; }
  textarea { height: auto; min-height: 80px; padding: 10px; line-height: 1.5; }

  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
  .time-field { display: flex; gap: 5px; }
  
  .item-row, .food-row { background: #252525; padding: 10px; margin-bottom: 10px; border-radius: 6px; border-left: 3px solid var(--border); position: relative; }
  .item-controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 8px; }
  .food-inputs { display: grid; grid-template-columns: 1fr 60px 65px; gap: 5px; margin-top: 8px; }
  .item-controls input, .food-inputs input { text-align: center; padding: 0; height: 38px; font-size: 0.9rem; }
  .custom-input { display: none; border-color: var(--accent); margin-top:5px; }
  .custom-input.show { display: block; }

  button { 
    background: #333; color: #ddd; border: none; padding: 0; height: 45px; 
    border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.9rem; 
    width: 100%; letter-spacing: 1px; display: flex; align-items: center; justify-content: center; 
    /* V33ä¿®æ­£ï¼šå¢åŠ é»æ“Šéˆæ•åº¦ï¼Œç§»é™¤300mså»¶é² */
    touch-action: manipulation; 
  }
  button:active { transform: scale(0.98); background: #444; }
  button.ghost { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
  button.ghost:active { background: var(--accent); color: #000; }
  button.add-btn { margin-top: 8px; background: rgba(255,255,255,0.05); border: 1px dashed #555; color: #888; }
  button.sm { width: auto; padding: 0 12px; min-width: 50px; font-size: 0.8rem; }
  .del-btn { position: absolute; top: 8px; right: 8px; width: 24px; height: 24px; background: #333; color: #aaa; padding: 0; border-radius: 4px; font-size: 1rem; }

  .float-action { 
    position: fixed; bottom: 0; left: 0; width: 100%; 
    background: rgba(25, 25, 25, 0.95); backdrop-filter: blur(20px); 
    padding: 15px 20px; border-top: 1px solid #444; 
    padding-bottom: calc(15px + env(safe-area-inset-bottom));
    display: grid; grid-template-columns: 60px 1fr 1fr; gap: 12px; z-index: 90; 
    box-shadow: 0 -5px 20px rgba(0,0,0,0.8);
  }
  .float-action button.icon-only { background: #333; color: var(--text-sub); font-size: 1.4rem; height: 50px; }
  .float-action button.main { background: var(--accent); color: #000; font-weight: 700; height: 50px; }

  /* === TIMER UI V33 (IPHONE OPTIMIZED) === */
  #timerBtn { 
    position: fixed; bottom: 100px; right: 20px; z-index: 99; width: 68px; height: 68px; 
    background: var(--card); border: 2px solid var(--accent); color: var(--accent); 
    display: flex; align-items: center; justify-content: center; 
    font-size: 22px; font-weight: 700; border-radius: 50%; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.5); font-family: 'Roboto Mono'; 
    touch-action: manipulation;
  }

  #timerPanel { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: rgba(18, 18, 18, 0.98); backdrop-filter: blur(10px); 
    z-index: 999; display: none; flex-direction: column; align-items: center; justify-content: center; 
    padding: 20px; opacity: 0; transition: opacity 0.2s; 
    
    /* V33ä¿®æ­£ï¼šé˜²æ­¢iOSå´æ»‘è¿”å›ï¼Œé˜²æ­¢é¸å–æ–‡å­— */
    touch-action: none; 
    overscroll-behavior: none;
    overscroll-behavior-x: none; /* å¼·åˆ¶ç¦æ­¢æ°´å¹³å›å½ˆ(ä¸Šä¸€é ) */
    user-select: none; /* é˜²æ­¢é€£é»é¸å–æ–‡å­— */
    -webkit-user-select: none;

    /* V33ä¿®æ­£ï¼šå®‰å…¨å€åŸŸï¼Œé¿é–‹ç€æµ·èˆ‡HomeBar */
    padding-top: calc(20px + env(safe-area-inset-top));
    padding-bottom: calc(40px + env(safe-area-inset-bottom));
  }
  #timerPanel.show { display: flex; opacity: 1; }

  .dashboard-card { width: 100%; max-width: 400px; background: #1e1e1e; border: 1px solid #444; border-radius: 16px; padding: 30px 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px; }
  .timer-label { font-size: 0.9rem; color: var(--text-sub); letter-spacing: 2px; margin-bottom: 5px; }
  .total-time { font-size: 1.5rem; color: #aaa; font-family: 'Roboto Mono'; margin-bottom: 15px; }
  .main-time { font-size: 5rem; color: #fff; font-family: 'Roboto Mono'; font-weight: 300; line-height: 1; margin: 10px 0 30px 0; letter-spacing: -2px; }
  
  .timer-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 400px; }
  
  /* V33ä¿®æ­£ï¼šå¢å¤§è¨ˆæ™‚å™¨æŒ‰éˆ•è§¸æ§å€èˆ‡éˆæ•åº¦ */
  .timer-controls button { 
    padding: 0; font-size: 1.2rem; border-radius: 12px; 
    height: 65px; /* åŠ å¤§é«˜åº¦ */
    touch-action: manipulation; /* é—œéµï¼šç§»é™¤æ‰‹æ©Ÿé»æ“Šå»¶é² */
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .btn-start { background: var(--accent); color: #0d2b0d; }
  .btn-pause { background: var(--warn); color: #3d0d0d; }
  .btn-secondary { background: #333; color: #ccc; }
  
  .laps-wrapper { width: 100%; max-width: 400px; height: 30vh; background: #1a1a1a; border: 1px solid #333; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
  .laps-header { background: #222; padding: 10px 20px; font-size: 0.85rem; color: #666; display: flex; justify-content: space-between; border-bottom: 1px solid #333; }
  .laps-list { overflow-y: auto; flex: 1; padding: 0; margin: 0; list-style: none; overscroll-behavior: contain; }
  .lap-row { display: flex; justify-content: space-between; padding: 12px 20px; font-family: 'Roboto Mono'; color: #aaa; border-bottom: 1px solid #222; font-size: 1rem; }
  .lap-row:nth-child(even) { background: #1e1e1e; }
  .lap-row:first-child { color: var(--text-main); font-weight: bold; background: rgba(107, 142, 35, 0.1); }
  
  .close-timer-btn { position: absolute; top: calc(20px + env(safe-area-inset-top)); right: 20px; background: transparent; color: #666; width: auto; font-size: 0.9rem; padding: 10px; border: 1px solid #444; touch-action: manipulation; }

  #toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--accent); color: #000; padding: 15px 30px; font-weight: bold; border-radius: 4px; pointer-events: none; opacity: 0; transition: 0.2s; z-index: 1000; box-shadow: 0 0 20px rgba(0,255,195,0.4); }
  #toast.show { opacity: 1; }
  
  #copyArea { position: fixed; bottom: 0; left: 0; opacity: 0; pointer-events: none; width: 1px; height: 1px; }
</style>
</head>
<body>

<div id="toast">âœ… å·²å­˜æª”</div>

<div id="timerBtn" onclick="toggleTimer()">00</div>

<div id="timerPanel">
  <button class="close-timer-btn" onclick="toggleTimer()">âœ• ç¸®å°</button>
  <div class="dashboard-card">
    <div class="timer-label">TOTAL TIME ç¸½æ™‚é•·</div>
    <div class="total-time" id="tTotal">00:00.00</div>
    <div style="height:1px; background:#333; margin:10px 20px;"></div>
    <div class="timer-label" style="margin-top:15px; color:var(--accent);">CURRENT LAP åˆ†æ®µ</div>
    <div class="main-time" id="tVal">00:00</div>
  </div>
  <div class="timer-controls">
    <button class="btn-start" id="tAction" onclick="timerAct()">é–‹å§‹</button>
    <button class="btn-secondary" onclick="timerLapReset()" id="tLapReset">è¨ˆåœˆ</button>
  </div>
  <div style="height:20px;"></div>
  <div class="laps-wrapper">
    <div class="laps-header"><span>åœˆæ•¸ (LAP)</span><span>æ™‚é–“ (TIME)</span></div>
    <ul class="laps-list" id="lapsList"></ul>
  </div>
</div>

<div class="shell">
  <h1>ZiP TACTICAL LOG /// v33</h1>

  <section>
    <h2>æ—¥æœŸèˆ‡æ™‚æ®µ <small>DATE & RANGE</small></h2>
    <div class="row">
        <div><label>æ—¥æœŸ (Date)</label><input type="date" id="dateVal"></div>
        <div><label>ç¸½å€é–“ (RANGE)</label><input type="text" id="timeRange" placeholder="ä¾‹ 19:00 - 21:00"></div>
    </div>
  </section>

  <section>
    <h2>é‡è¨“ <small>RESISTANCE</small></h2>
    <div class="row">
      <div><label>é‡è¨“é–‹å§‹</label><div class="time-field"><input type="time" id="wtStart" oninput="autoTimeRange()"><button class="ghost sm" onclick="setNow('wtStart')">ç¾åœ¨</button></div></div>
      <div><label>é‡è¨“çµæŸ</label><div class="time-field"><input type="time" id="wtEnd" oninput="autoTimeRange()"><button class="ghost sm" onclick="setNow('wtEnd')">ç¾åœ¨</button></div></div>
    </div>
    <div style="text-align:right; color:var(--text-sub); font-size:0.8rem; margin-bottom:15px;" id="wtDur">æŒçºŒæ™‚é–“: 0 åˆ†é˜</div>
    
    <div id="exerciseList"></div>
    <button class="add-btn" onclick="addExercise()">[+] æ–°å¢å‹•ä½œ</button>
  </section>

  <section>
    <h2>æœ‰æ°§ <small>CARDIO</small></h2>
    <div class="row" style="margin-bottom:15px; border-bottom:1px dashed #333; padding-bottom:15px;">
       <div><label>æœ‰æ°§é–‹å§‹</label><div class="time-field"><input type="time" id="caStart" oninput="autoTimeRange()"><button class="ghost sm" onclick="setNow('caStart')">ç¾åœ¨</button></div></div>
       <div><label>æœ‰æ°§çµæŸ</label><div class="time-field"><input type="time" id="caEnd" oninput="autoTimeRange()"><button class="ghost sm" onclick="setNow('caEnd')">ç¾åœ¨</button></div></div>
    </div>
    <div id="cardioList"></div>
    <button class="add-btn" onclick="addCardio()">[+] æ–°å¢æœ‰æ°§</button>
    <div style="margin-top:15px;"><label>ä¼¸å±•æ™‚é–“ (åˆ†é˜)</label><input type="number" id="stretch" placeholder="ä¾‹å¦‚: 15" oninput="autoTimeRange()"></div>
  </section>

  <section>
    <h2>é£²é£Ÿç´€éŒ„ <small>NUTRITION</small></h2>
    
    <label class="sub-label">æ—©é¤ Breakfast</label>
    <div id="listBreakfast"></div><button class="add-btn sm" onclick="addFood('listBreakfast', 'breakfast-options')">[+] æ–°å¢</button>

    <label class="sub-label">åˆé¤ Lunch</label>
    <div id="listLunch"></div><button class="add-btn sm" onclick="addFood('listLunch', 'lunch-options')">[+] æ–°å¢</button>

    <label class="sub-label">ä¸‹åˆèŒ¶ Snack</label>
    <div id="listSnack"></div><button class="add-btn sm" onclick="addFood('listSnack', 'snack-options')">[+] æ–°å¢</button>

    <label class="sub-label">é‹å‹•å‰è£œçµ¦ Pre-Workout</label>
    <div id="listPre"></div><button class="add-btn sm" onclick="addFood('listPre', 'pre-options')">[+] æ–°å¢</button>

    <label class="sub-label">æ™šé¤ / é‹å‹•å¾Œ Post-Workout</label>
    <div id="listPost"></div><button class="add-btn sm" onclick="addFood('listPost', 'post-options')">[+] æ–°å¢</button>

    <div style="margin-top:25px; padding-top:15px; border-top:1px solid #333;">
        <label class="sub-label" style="border:none; color:var(--text-main);">é£²æ°´ç¸½é‡ (ML)</label>
        <div class="row">
            <input type="number" id="wWork" placeholder="é‹å‹•é£²æ°´" oninput="calcWater()">
            <input type="number" id="wDay" placeholder="æ—¥å¸¸é£²æ°´" oninput="calcWater()">
        </div>
        <div style="text-align:right; color:var(--accent); font-size:0.95rem; font-weight:bold;" id="wTotal">ç¸½è¨ˆ: 0 ML</div>
    </div>
  </section>

  <section>
    <h2>å‚™è¨» <small>NOTES</small></h2>
    <textarea id="note" placeholder="ç´€éŒ„ä»Šæ—¥èº«é«”ç‹€æ³..."></textarea>
  </section>
</div>

<div class="float-action">
  <button class="icon-only" onclick="forceReset()">ğŸ—‘ï¸</button>
  <button class="ghost" onclick="genText()">ğŸ“‹ è¤‡è£½æ—¥èªŒ</button>
  <button class="main" onclick="manualSave()">ğŸ’¾ æ‰‹å‹•å­˜æª”</button>
</div>
<textarea id="copyArea"></textarea>

<template id="equipment-options">
  <option value="">â€” é¸æ“‡å™¨æ â€”</option>
  <optgroup label="èƒŒéƒ¨èˆ‡ä¸ŠåŠèº«">
    <option>è´è¶æ©Ÿï¼ˆå¤¾èƒ¸ï¼‰</option><option>è´è¶æ©Ÿï¼ˆåé¢èƒŒé£›ï¼‰</option><option>åˆ†é›¢å¼åå§¿åˆ’èˆ¹æ©Ÿï¼é›™æ‰‹</option><option>åˆ†é›¢å¼åå§¿åˆ’èˆ¹æ©Ÿï¼å·¦å³æ‰‹äº¤æ›¿</option><option>åˆ†é›¢å¼åå§¿åˆ’èˆ¹æ©Ÿï¼å·¦æ‰‹</option><option>åˆ†é›¢å¼åå§¿åˆ’èˆ¹æ©Ÿï¼å³æ‰‹</option>
    <option>åå§¿åˆ’èˆ¹æ©Ÿ</option><option>é«˜ä½ä¸‹æ‹‰ï¼ˆå¯¬è·ï¼‰</option><option>é«˜ä½ä¸‹æ‹‰ï¼ˆçª„è·ï¼‰</option><option>é«˜ä½ä¸‹æ‹‰ï¼ˆçª„è·åæ¡ï¼‰</option><option>é«˜ä½ä¸‹æ‹‰ï¼ˆWæŠŠæ‰‹ï¼‰</option><option>é«˜ä½ä¸‹æ‹‰ï¼ˆVæŠŠæ‰‹ï¼‰</option>
  </optgroup>
  <optgroup label="ä¸‹åŠèº«">
    <option>è…¿éƒ¨å€’æ¨è¹¬æ©Ÿ</option><option>è…¿éƒ¨æ¨è¹¬æ©Ÿï¼æ°´å¹³</option><option>åå§¿å‹¾è…¿æ©Ÿ</option>
    <option>ä¿¯è‡¥å‹¾è…¿æ©Ÿ</option><option>å¤¾è…¿æ©Ÿ</option><option>é–‹è…¿æ©Ÿ</option><option>ä¸‹èƒŒè¨“ç·´æ©Ÿ</option>
    <option>45Â° ä¸‹èƒŒä¼¸å±•æ©Ÿ</option><option>Hack Squat å“ˆå…‹æ·±è¹²</option>
  </optgroup>
  <optgroup label="æ ¸å¿ƒ"><option>å·è…¹æ©Ÿ</option><option>æ—‹è½‰è»€å¹¹æ©Ÿï¼å·¦</option><option>æ—‹è½‰è»€å¹¹æ©Ÿï¼å³</option></optgroup>
  <optgroup label="ç¹©ç´¢è¨“ç·´ (Cable)">
    <option>èƒ¸å‰äº¤å‰</option>
    <option>ç«™ç«‹æ»‘è¼ªä¸‹æ‹‰</option>
    <option>å´å¹³èˆ‰</option>
    <option>å–®æ‰‹åå‘é£›é³¥ å·¦</option>
    <option>å–®æ‰‹åå‘é£›é³¥ å³</option>
    <option>åˆ’èˆ¹</option>
    <option>ä¸‹å£“</option>
    <option>äºŒé ­å½èˆ‰</option>
    <option>æœ¨æ–§</option>
    <option>é¢æ‹‰</option>
  </optgroup>
  <option value="__custom__">è‡ªè¨‚...</option>
</template>
<template id="cardio-options"><option value="">â€” é¸æ“‡é …ç›® â€”</option><option>æ»‘æ­¥æ©Ÿ</option><option>éšæ¢¯æ©Ÿ</option><option>è¸æ­¥æ©Ÿ</option><option>èººå¼è…³è¸è»Š</option><option>ç›´ç«‹è…³è¸è»Š</option><option>è·‘æ­¥æ©Ÿ</option><option value="__custom__">è‡ªè¨‚...</option></template>

<template id="breakfast-options">
    <option value="">â€” é¸æ“‡é£Ÿç‰© â€”</option>
   <option>ç¾å¼å’–å•¡</option><option>è¥¿è¥¿é‡Œå’–å•¡</option><option>ç„¡ç³–ç¶ èŒ¶</option><option>æ°£æ³¡æ°´</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯ (206cal 20.3g P,375ml)</option>
<option>æ—é³³ç‡Ÿå¸Œè‡˜å¼å„ªæ ¼(åŸå‘³ç„¡ç³–)</option><option>å …æœè›‹ç™½æ£’(260cal 14g P)</option><option>ä½ç³–è›‹ç™½æ£’(132cal 6g P)</option><option>è·åŒ…è›‹</option><option>æ»·è›‹</option>
<option>çƒ¤åœŸå¸</option><option>è‡ªè£½æ°å·´å¡”</option><option>å…¨å®¶ è‘¡è„åå¸2ç‰‡</option><option>å‰ç‡’åŒ…</option><option>è‚‰æ¡‚æ²</option><option>è˜¿è””ç³•</option><option>ç™½é¥…é ­</option><option>é»‘é¥…é ­</option><option>èŠéº»åŒ…</option>
<option>å¾¡é£¯ç³°(ç‡’è‚‰ 201cal 4.4g P)</option><option>å¾¡é£¯ç³°(é›è‚‰ 218cal 6.4g P)</option><option>å¾¡é£¯ç³°(é›è‚‰ 181cal)</option><option>å¾¡é£¯ç³°(é®­é­š 172cal)</option>
<option>è’¸åœ°ç“œ(å†°)</option><option>è’¸åœ°ç“œ(ç†±)</option><option>çƒ¤åœ°ç“œ(å†°)</option><option>çƒ¤åœ°ç“œ(ç†±)</option>
<option>ç¶ è±†è–ä»</option><option>è“®å­ç´…æ£—æ¸å·±éŠ€è€³æ¹¯</option><option>ç‰ç±³ç²’</option><option>èŠ±ç”Ÿé†¬</option><option>ç„¡èŠ±æœé†¬</option><option>é»‘é†‹æ —é†¬</option><option>è‰è“é†¬</option>
    <option value="__custom__">è‡ªè¨‚...</option>
</template>

<template id="lunch-options">
    <option value="">â€” é¸æ“‡é£Ÿç‰© â€”</option>
    <option>èƒ½é‡å°å§-æ°´ç…®å«©é›èƒ¸</option><option>èƒ½é‡å°å§-é¦™æ»·é›è…¿</option><option>èƒ½é‡å°å§-æ—¥å¼å£½å–œç‰›ä¾¿ç•¶</option><option>èƒ½é‡å°å§-ç…§ç‡’é›è…¿æ’</option><option>ç«¹æ—ä¾¿ç•¶-é¦™é…¥å¤§é›æ’é£¯</option><option>ç«¹æ—ä¾¿ç•¶-åšåˆ‡è±¬æ’é£¯</option><option>å¤©å¤©çƒ¤è‚‰-æ‹›ç‰Œçƒ¤è‚‰é£¯</option><option>æ„›é¢ç…®ï¼ˆç´…ç‡’ç‰›è‚‰é¢¨å‘³ï¼‰</option>
    <option>ç‰›æ’</option><option>ç‚’é›ä¸</option><option>ç´™åŒ…é®­é­š</option><option>ç‚’é›èƒ¸</option><option>é†¬ç‡’é›èƒ¸è‚‰</option><option>ä¸‰æ¯é›</option><option>é›çµ²</option><option>æ——é­šç”Ÿé­šç‰‡</option><option>é®ªé­šç”Ÿé­šç‰‡</option><option>é®­é­šç”Ÿé­šç‰‡</option><option>é¯¡é­šåµç”Ÿé­šç‰‡</option>
    <option>é¦¬éˆ´è–¯æ³¥</option><option>é¦¬éˆ´è–¯</option><option>è’¸åœ°ç“œ(å†°)</option><option>è’¸åœ°ç“œ(ç†±)</option><option>çƒ¤åœ°ç“œ(å†°)</option><option>çƒ¤åœ°ç“œ(ç†±)</option><option>ç™½é£¯</option><option>ç³™ç±³é£¯</option><option>é†‹é£¯</option><option>ç‚’é£¯</option><option>å …æœè›‹ç™½æ£’(260cal 14g P)</option><option>ä½ç³–è›‹ç™½æ£’(132cal 6g P)</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯ (206cal 20.3g P,375ml)</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯å …æœ (208cal 20.6g P,375 mL)</option>
    <option>èŠ±æ¤°èœ</option><option>ç‚’æ´‹è”¥</option><option>ç‚’é«˜éº—èœ</option><option>å››å­£è±†</option><option>å°é»ƒç“œ</option><option>ç‰ç±³ç²’</option><option>é«˜éº—èœ</option><option>æ²™æ‹‰é†¬(10ml/11cal)</option><option>ç¶ è±†è–ä»</option><option>è“®å­ç´…æ£—æ¸å·±éŠ€è€³æ¹¯</option><option>ç¾å¼å’–å•¡</option><option>è¥¿è¥¿é‡Œå’–å•¡</option><option>æ‰‹æ²–å’–å•¡</option><option>ç„¡ç³–ç¶ èŒ¶</option><option>æ°£æ³¡æ°´</option>
    <option value="__custom__">è‡ªè¨‚...</option>
</template>

<template id="snack-options">
    <option value="">â€” é¸æ“‡é£Ÿç‰© â€”</option>
    <option>ç¾å¼å’–å•¡</option><option>ç„¡ç³–ç¶ èŒ¶</option><option>æ°£æ³¡æ°´</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯ (206cal 20.3g P,375ml)</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯å …æœ (208cal 20.6g P,375 mL)</option><option>ä¹³æ¸…è›‹ç™½ 40g</option><option>ä¹³æ¸…è›‹ç™½ 30g</option>
    <option>å …æœè›‹ç™½æ£’(260cal 14g P)</option><option>ä½ç³–è›‹ç™½æ£’(132cal 6g P)</option>
    <option>åŸå‘³å„ªæ ¼</option><option>æ—é³³ç‡Ÿ å¸Œè‡˜å¼å„ªæ ¼(åŸå‘³ç„¡ç³–)</option><option>é¤…ä¹¾ï¼å°é»å¿ƒ</option><option>ç¶ è±†è–ä»</option><option>è“®å­ç´…æ£—æ¸å·±éŠ€è€³æ¹¯</option><option>è’¸åœ°ç“œ(å†°)</option><option>è’¸åœ°ç“œ(ç†±)</option><option>çƒ¤åœ°ç“œ(å†°)</option><option>çƒ¤åœ°ç“œ(ç†±)</option>
    <option>æ°´æœï¼ˆèŠ­æ¨‚ï¼‰</option><option>èŠ­æ¨‚</option><option>è˜‹æœ</option><option>èŠ’æœ</option><option>æ°´æ¢¨</option><option>æŸ³ä¸</option><option>æ©˜å­</option><option>å»æ®¼æ¤°å­</option><option>è—è“</option><option>é‡‹è¿¦</option>
    <option value="__custom__">è‡ªè¨‚...</option>
</template>

<template id="pre-options">
    <option value="">â€” é¸æ“‡é£Ÿç‰© â€”</option>
    <option>ç¾å¼å’–å•¡</option><option>è¥¿è¥¿é‡Œå’–å•¡</option><option>æ‰‹æ²–å’–å•¡</option><option>ç„¡ç³–ç¶ èŒ¶</option><option>æ°£æ³¡æ°´</option><option>å…‰æ³‰ å„ªè³ªè›‹ç™½ç‰›ä¹³ å·§å…‹åŠ›å£å‘³ (400ml)</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯ (206cal 20.3g P,375ml)</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯å …æœ (208cal 20.6g P,375 mL)</option>
    <option>å …æœè›‹ç™½æ£’(260cal 14g P)</option><option>ä½ç³–è›‹ç™½æ£’(132cal 6g P)</option><option>ä¹³æ¸…è›‹ç™½ 40g</option><option>ä¹³æ¸…è›‹ç™½ 30g</option>
    <option>å¾¡é£¯ç³°(ç‡’è‚‰ 201cal 4.4g P)</option><option>å¾¡é£¯ç³°(é›è‚‰ 218cal 6.4g P)</option><option>è’¸åœ°ç“œ(å†°)</option><option>è’¸åœ°ç“œ(ç†±)</option><option>çƒ¤åœ°ç“œ (å†°)</option><option>çƒ¤åœ°ç“œ (ç†±)</option><option>å…¨å®¶ è‘¡è„åå¸2ç‰‡</option><option>å…¨å®¶ å¤§äº¨å ¡ (åŸå‘³ç†±ç‹—+ç•ªèŒ„é†¬é…¸é»ƒç“œé†¬)</option><option>ç¶ è±†è–ä»</option><option>è“®å­ç´…æ£—æ¸å·±éŠ€è€³æ¹¯</option>
    <option>é¦™è•‰</option><option>èŠ­æ¨‚</option><option>è˜‹æœ</option><option>èŠ’æœ</option><option>æ°´æ¢¨</option><option>æŸ³ä¸</option><option>æ©˜å­</option><option>å»æ®¼æ¤°å­</option><option>è—è“</option><option>é‡‹è¿¦</option>
    <option value="__custom__">è‡ªè¨‚...</option>
</template>

<template id="post-options">
    <option value="">â€” é¸æ“‡é£Ÿç‰© â€”</option>
    <option>ç‰›æ’</option><option>ç‰›é›œæ¹¯ï¼ˆåªåƒæ–™ï¼‰</option><option>ç‚’é›ä¸</option><option>ç‚’é›èƒ¸</option><option>é›çµ²</option><option>ç´™åŒ…é®­é­š</option><option>æ——é­šç”Ÿé­šç‰‡</option><option>é®ªé­šç”Ÿé­šç‰‡</option><option>é®­é­šç”Ÿé­šç‰‡</option><option>é¯¡é­šåµç”Ÿé­šç‰‡</option><option>æ„›ä¹‹å‘³é®ªé­šç½é ­ï¼ˆæ°´ç…®ï¼‰185g</option>
    <option>è·åŒ…è›‹</option><option>æ»·è›‹</option><option>æºå¿ƒè›‹</option><option>èŠ±æ¤°èœ</option><option>ç‚’æ´‹è”¥</option><option>ç‚’é«˜éº—èœ</option><option>æ°´ç…®é«˜éº—èœ</option><option>å››å­£è±†</option><option>å°é»ƒç“œ</option><option>ç‰ç±³ç²’</option><option>è±†è–¯æ¶¼æ‹Œ</option><option>æ²™æ‹‰é†¬(10ml/11cal)</option>
    <option>ç™½é£¯</option><option>ç³™ç±³é£¯</option><option>é†‹é£¯</option><option>å¾¡é£¯ç³°(ç‡’è‚‰ 201cal 4.4g P)</option><option>å¾¡é£¯ç³°(é›è‚‰ 218cal 6.4g P)</option><option>é¦¬éˆ´è–¯æ³¥</option><option>é¦¬éˆ´è–¯</option><option>è’¸èŠ‹é ­</option><option>èŠ‹é ­æ³¥</option><option>è’¸åœ°ç“œ(å†°)</option><option>è’¸åœ°ç“œ(ç†±)</option><option>çƒ¤åœ°ç“œ(å†°)</option><option>çƒ¤åœ°ç“œ(ç†±)</option>
    <option>ç¾å¼å’–å•¡</option><option>è¥¿è¥¿é‡Œå’–å•¡</option><option>æ‰‹æ²–å’–å•¡</option><option>ç„¡ç³–ç¶ èŒ¶</option><option>ç„¡ç³–ç´…èŒ¶</option><option>æ°£æ³¡æ°´</option><option>Myproteinåˆ†é›¢å¼ä¹³æ¸…è›‹ç™½-è‹±å¼å¥¶èŒ¶ 40g</option><option>Myproteinåˆ†é›¢å¼ä¹³æ¸…è›‹ç™½-è‹±å¼å¥¶èŒ¶ 30g</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯ (206cal 20.3g P,375ml)</option><option>ç¦æ¨‚ è¶…èƒ½è›‹ç™½ç‡Ÿé¤Šç‰›ä¹³ å¯å¯å …æœ (208cal 20.6g P,375 mL)</option><option>å …æœè›‹ç™½æ£’(260cal 14g P)</option><option>ä½ç³–è›‹ç™½æ£’(132cal 6g P)</option><option>åŸå‘³å„ªæ ¼</option><option>ç¶ è±†è–ä»</option><option>è“®å­ç´…æ£—æ¸å·±éŠ€è€³æ¹¯</option>
    <option>è˜‹æœ</option><option>æ°´æ¢¨</option><option>æŸ³ä¸</option><option>æ©˜å­</option><option>èŠ­æ¨‚</option><option>èŠ’æœ</option><option>å»æ®¼æ¤°å­</option><option>è—è“</option><option>é‡‹è¿¦</option><option value="__custom__">è‡ªè¨‚...</option>
</template>

<script>
const KEY = 'ZIP_LOG_V30_DATA';
const val = s => document.querySelector(s)?.value || '';
const set = (s, v) => { const e = document.querySelector(s); if(e) e.value = v || ''; };
const getAll = s => [...document.querySelectorAll(s)];
const pad = n => String(n).padStart(2, '0');

let tInt = null, totalStartTime = 0, lapStartTime = 0, tTotalElapsed = 0, laps = [];
let lapPausedTime = 0;

// === ä¿®æ­£ï¼šå„ªåŒ–å–®ä½åˆ¤æ–·é‚è¼¯ï¼ŒåŠ å…¥ç“¶/ç½ï¼Œä¸¦è®“åŒ…è£é£²å“å„ªå…ˆåŒ¹é…ç‚ºã€Œç“¶ã€ ===
function checkUnit(v, u) {
  const m = { 
    'ä»½':['ä¾¿','é¤','å ¡','æ²»','éºµ','èƒ½é‡å°å§','ç«¹æ—','æ„›é¢ç…®'], 
    'ç“¶':['ç¦æ¨‚','å…‰æ³‰','æ°£æ³¡æ°´','é…’'], 
    'ç½':['ç½é ­','ç½'],
    'å€‹':['ç´™','å¡”','æ´¾'], 
    'é¡†':['è›‹','æœ','æ©˜','æŸ³','å¥‡','é¤ƒ','éŒ ','æ¤°','ç³°','åŒ…','é¥…é ­'], 
    'ml':['å’–','èŒ¶','é£²','æ°´','æ¹¯','å¥¶','ä¹³','é†¬'], 
    'g':['é›','ç‰›','è±¬','é­š','è‚‰','é£¯','ç“œ','è–¯','èœ','æ ¼','è›‹ç™½','è±†','è”¥','ä¸','æ³¥'], 
    'ç‰‡':['å','é¤…','èµ·','ç³•','æ’'], 
    'æ¢':['æ£’'], 
    'åŒ…':['çµ²']
  };
  for(const [k, arr] of Object.entries(m)) if(arr.some(x => v.includes(x))) { u.value = k; break; }
}

function autoTimeRange() {
    const times = [ val('#wtStart'), val('#wtEnd'), val('#caStart'), val('#caEnd') ].filter(t => t !== ""); 
    if (times.length < 2 && !val('#stretch')) return;
    
    times.sort();
    let startTime = times[0] || '';
    let endTime = times[times.length - 1] || '';

    // è¨ˆç®—ä¼¸å±•æ™‚é–“
    const stretchMin = parseInt(val('#stretch')) || 0;
    if (stretchMin > 0 && endTime) {
        const [h, m] = endTime.split(':').map(Number);
        const date = new Date(); 
        date.setHours(h, m + stretchMin);
        endTime = `${pad(date.getHours())}:${pad(date.getMinutes())}`;
    }

    if(startTime && endTime) set('#timeRange', `${startTime} - ${endTime}`);
}

function createRow(tid, ph, vals={}) {
  const div=document.createElement('div'); div.className=tid.includes('option')&&!tid.includes('equip')&&!tid.includes('cardio')?'food-row':'item-row';
  const sel=document.createElement('select'); sel.innerHTML=document.getElementById(tid).innerHTML;
  const cust=document.createElement('input'); cust.type='text'; cust.className='custom-input'; cust.placeholder=ph;
  const del=document.createElement('button'); del.innerHTML='âœ•'; del.className='del-btn'; del.onclick=()=>div.remove();
  const chk=(v)=>{if(div.querySelector('.unit'))checkUnit(v,div.querySelector('.unit'));};
  sel.onchange=()=>{if(sel.value==='__custom__'){cust.classList.add('show');cust.focus();}else{cust.classList.remove('show');chk(sel.value);}};
  cust.oninput=()=>chk(cust.value);
  if(vals.n){ if([...sel.options].some(o=>o.value===vals.n))sel.value=vals.n; else{sel.value='__custom__';cust.classList.add('show');cust.value=vals.n;} }
  div.append(del,sel,cust); return {div,sel,cust};
}

function addExercise(d={}) {
  const {div}=createRow('equipment-options','å™¨æåç¨±',d);
  const c=document.createElement('div'); c.className='item-controls';
  c.innerHTML=`<input type="number" class="s" placeholder="çµ„" value="${d.s||''}"><input type="number" class="r" placeholder="æ¬¡" value="${d.r||''}"><input type="number" class="w" placeholder="kg" value="${d.w||''}"><input type="number" class="rt" placeholder="ä¼‘(s)" value="${d.rt||''}">`;
  div.append(c); document.getElementById('exerciseList').append(div);
}
function addCardio(d={}) {
  const {div}=createRow('cardio-options','æœ‰æ°§é …ç›®',d);
  const c=document.createElement('div'); c.className='item-controls'; c.style.gridTemplateColumns="1fr 1fr 1fr";
  c.innerHTML=`<input type="number" class="dur" placeholder="åˆ†" value="${d.dur||''}"><input type="number" class="lv" placeholder="Lv" value="${d.lv||''}"><input type="number" class="bpm" placeholder="å¿ƒç‡" value="${d.bpm||''}">`;
  div.append(c); document.getElementById('cardioList').append(div);
}

// === ä¿®æ­£ï¼šaddFood çš„ä¸‹æ‹‰é¸å–®åŠ å…¥ã€Œç“¶ã€èˆ‡ã€Œç½ã€ ===
function addFood(lid,tid,d={}) {
  const {div}=createRow(tid,'é£Ÿç‰©åç¨±',d);
  const c=document.createElement('div'); c.className='food-inputs';
  c.innerHTML=`<input type="number" class="amt" placeholder="é‡" value="${d.a||''}"><select class="unit"><option value="g">g</option><option value="ml">ml</option><option value="ä»½">ä»½</option><option value="é¡†">é¡†</option><option value="ç‰‡">ç‰‡</option><option value="åŒ…">åŒ…</option><option value="æ¢">æ¢</option><option value="ç›’">ç›’</option><option value="å€‹">å€‹</option><option value="ç“¶">ç“¶</option><option value="ç½">ç½</option></select>`;
  if(d.u)c.querySelector('.unit').value=d.u;
  div.append(c); document.getElementById(lid).append(div);
}

function getName(r){const s=r.querySelector('select'),c=r.querySelector('.custom-input');return s.value==='__custom__'?c.value:s.value;}
function v(p,s){return p.querySelector(s)?.value||'';}

// Save/Load
function save(silent=true) {
  const d={
    dateVal: val('#dateVal'), timeRange: val('#timeRange'),
    wtStart:val('#wtStart'), wtEnd:val('#wtEnd'), caStart:val('#caStart'), caEnd:val('#caEnd'), stretch:val('#stretch'), wWork:val('#wWork'), wDay:val('#wDay'), note:val('#note'),
    exs: getAll('#exerciseList .item-row').map(r=>({n:getName(r),s:v(r,'.s'),r:v(r,'.r'),w:v(r,'.w'),rt:v(r,'.rt')})),
    cardios: getAll('#cardioList .item-row').map(r=>({n:getName(r),dur:v(r,'.dur'),lv:v(r,'.lv'),bpm:v(r,'.bpm')})),
    foods: {bf:getF('listBreakfast'),lu:getF('listLunch'),sn:getF('listSnack'),pre:getF('listPre'),post:getF('listPost')},
    timer: {totalStart:totalStartTime, lapStart:lapStartTime, totalElapsed:tTotalElapsed, running:!!tInt, laps:laps, lapPausedTime: lapPausedTime}
  };
  localStorage.setItem(KEY,JSON.stringify(d));
  if(!silent){const t=document.getElementById('toast');t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1000);}
}
function getF(id){return getAll(`#${id} .food-row`).map(r=>({n:getName(r),a:v(r,'.amt'),u:v(r,'.unit')}));}

function load() {
  const raw=localStorage.getItem(KEY);
  if(!raw) { 
      initDate(); addExercise(); return; 
  }
  const d=JSON.parse(raw);
  if(d.dateVal) set('#dateVal', d.dateVal); else initDate();
  set('#timeRange', d.timeRange);
  set('#wtStart',d.wtStart); set('#wtEnd',d.wtEnd); set('#caStart',d.caStart); set('#caEnd',d.caEnd); 
  set('#stretch',d.stretch); set('#wWork',d.wWork); set('#wDay',d.wDay); set('#note',d.note);
  document.getElementById('exerciseList').innerHTML=''; if(d.exs)d.exs.forEach(x=>addExercise(x));
  document.getElementById('cardioList').innerHTML=''; if(d.cardios)d.cardios.forEach(x=>addCardio(x));
  const rf=(lid,tid,l)=>{document.getElementById(lid).innerHTML='';if(l)l.forEach(x=>addFood(lid,tid,x));};
  if(d.foods){ rf('listBreakfast','breakfast-options',d.foods.bf); rf('listLunch','lunch-options',d.foods.lu); rf('listSnack','snack-options',d.foods.sn); rf('listPre','pre-options',d.foods.pre); rf('listPost','post-options',d.foods.post); }
  
  if(d.timer) { 
    tTotalElapsed = d.timer.totalElapsed || 0; 
    laps = d.timer.laps || []; 
    lapPausedTime = d.timer.lapPausedTime || 0;
    renderLaps();
    if(d.timer.running) { 
        totalStartTime = d.timer.totalStart; 
        lapStartTime = d.timer.lapStart; 
        startT(); 
    } 
    else { 
        updT(lapPausedTime, tTotalElapsed); 
    }
  }
  calcTime(); calcWater();
}

function initDate() {
    const local = new Date();
    local.setMinutes(local.getMinutes() - local.getTimezoneOffset());
    document.getElementById('dateVal').value = local.toISOString().slice(0,10);
}

function fmtT(ms, showMs=true) { 
    const m = Math.floor(ms/60000); const s = Math.floor((ms%60000)/1000);
    if(!showMs) return `${pad(m)}:${pad(s)}`;
    const cs = Math.floor((ms%1000)/10);
    return `${pad(m)}:${pad(s)}.${pad(cs)}`;
}
function updT(lapMs, totalMs) {
  document.getElementById('tVal').innerText = fmtT(lapMs, false); 
  document.getElementById('tTotal').innerText = fmtT(totalMs); 
  document.getElementById('timerBtn').innerText = String(Math.floor((lapMs%60000)/1000)).padStart(2,'0');
}
function startT() {
  const btn = document.getElementById('tAction'); btn.innerText = "æš«åœ"; btn.className = "btn-pause"; document.getElementById('tLapReset').innerText = "è¨ˆåœˆ"; 
  tInt = setInterval(() => { 
      const now = Date.now(); 
      updT(now - lapStartTime, tTotalElapsed + (now - totalStartTime)); 
  }, 50);
}
function timerAct() {
  if(tInt) { 
      clearInterval(tInt); tInt = null; 
      const now = Date.now();
      tTotalElapsed += now - totalStartTime; 
      lapPausedTime = now - lapStartTime;    
      
      document.getElementById('tAction').innerText = "ç¹¼çºŒ"; document.getElementById('tAction').className = "btn-start"; document.getElementById('tLapReset').innerText = "é‡ç½®"; save(true); 
  }
  else { 
      const now = Date.now();
      if(totalStartTime === 0 || document.getElementById('tAction').innerText === "é–‹å§‹") { 
          totalStartTime = now; 
          lapStartTime = now; 
          tTotalElapsed = 0; 
          lapPausedTime = 0;
          laps = []; renderLaps(); 
      } else { 
          totalStartTime = now; 
          lapStartTime = now - lapPausedTime; 
      } 
      startT(); 
  }
}

function timerLapReset() {
  if(tInt) { 
      const now = Date.now();
      laps.unshift(now - lapStartTime); renderLaps(); 
      lapStartTime = now; 
  } 
  else { 
      tTotalElapsed = 0; totalStartTime = 0; lapStartTime = 0; lapPausedTime = 0; laps = []; 
      updT(0, 0); 
      document.getElementById('lapsList').innerHTML=''; 
      document.getElementById('tAction').innerText="é–‹å§‹"; document.getElementById('tAction').className="btn-start"; document.getElementById('tLapReset').innerText="è¨ˆåœˆ"; 
      save(true); 
  }
}
function renderLaps() { document.getElementById('lapsList').innerHTML = laps.map((t,i) => `<li class="lap-row"><span>åœˆ ${laps.length-i}</span><span>${fmtT(t)}</span></li>`).join(''); }

function toggleTimer() { 
    const p = document.getElementById('timerPanel');
    const b = document.body;
    p.classList.toggle('show'); 
    if(p.classList.contains('show')) { b.classList.add('lock-scroll'); } else { b.classList.remove('lock-scroll'); }
}

function forceReset() {
  if(confirm('âš ï¸ ç¢ºå®šè¦æ¸…ç©ºä¸¦é–‹å§‹æ–°çš„ä¸€å¤©å—ï¼Ÿ\n(ç›®å‰çš„ç´€éŒ„å°‡è¢«æ¸…é™¤)')) {
    localStorage.removeItem(KEY);
    document.querySelectorAll('input').forEach(el => el.value = '');
    document.querySelectorAll('textarea').forEach(el => el.value = '');
    document.getElementById('exerciseList').innerHTML = '';
    document.getElementById('cardioList').innerHTML = '';
    document.querySelectorAll('[id^="list"]').forEach(el => el.innerHTML = '');
    document.getElementById('wtDur').innerText = 'æŒçºŒæ™‚é–“: 0 åˆ†é˜';
    document.getElementById('wTotal').innerText = 'ç¸½è¨ˆ: 0 ML';
    if(tInt) clearInterval(tInt);
    tInt=null; totalStartTime=0; lapStartTime=0; tTotalElapsed=0; laps=[]; lapPausedTime=0;
    updT(0,0); 
    document.getElementById('lapsList').innerHTML='';
    initDate();
    setTimeout(() => location.reload(), 100);
  }
}

async function genText() {
  save(true); const d=JSON.parse(localStorage.getItem(KEY)); 
  const dateStr = d.dateVal ? d.dateVal.replace(/-/g, '/') : new Date().toLocaleDateString();
  let t=`ğŸ“… ${dateStr} è¨“ç·´æ—¥èªŒ\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
  const timeShow = d.timeRange ? d.timeRange : (d.wtStart ? `${d.wtStart} - ${d.wtEnd}` : '');
  if(timeShow) t += `â° æ™‚é–“: ${timeShow}\n`;
  if(d.exs.some(x=>x.n)) { t+=`\nğŸ‹ï¸ é‡è¨“é …ç›®\n`; d.exs.forEach(x=>{if(x.n)t+=`â€¢ ${x.n}ï½œ${x.s}çµ„Ã—${x.r}æ¬¡ï½œ${x.w}kg${x.rt?` (ä¼‘${x.rt}s)`:''}\n`}); }
  if(d.cardios.some(x=>x.n)||val('#caStart')) { t+=`\nğŸƒ æœ‰æ°§èˆ‡ä¼¸å±•\n`; d.cardios.forEach(x=>{if(x.n)t+=`â€¢ ${x.n}ï½œ${x.dur}åˆ† (Lv.${x.lv}/${x.bpm}bpm)\n`}); if(val('#stretch'))t+=`â€¢ ä¼¸å±•: ${val('#stretch')} åˆ†é˜\n`; }
  t+=`\nğŸ¥— é£²é£Ÿç´€éŒ„\n`;
  const ft=(l,h)=>{ if(l.some(x=>x.n)){ t+=`[${h}] `; t+=l.filter(x=>x.n).map(x=>`${x.n} ${x.a}${x.u}`).join('ã€')+'\n'; } };
  ft(d.foods.bf,'æ—©é¤'); ft(d.foods.lu,'åˆé¤'); ft(d.foods.sn,'åˆèŒ¶'); ft(d.foods.pre,'é‹å‰'); ft(d.foods.post,'é‹å¾Œ');
  t+=`\nğŸ’§ é£²æ°´ç¸½è¨ˆ: ${document.getElementById('wTotal').innerText.replace('ç¸½è¨ˆ: ','')}`;
  if(d.note) t+=`\n\nğŸ“ å‚™è¨»\n${d.note}`;
  
  try { await navigator.clipboard.writeText(t); alert('æ—¥èªŒå·²è¤‡è£½ï¼'); }
  catch(e) { const a=document.getElementById('copyArea'); a.value=t; a.select(); document.execCommand('copy'); alert('æ—¥èªŒå·²è¤‡è£½ (å…¼å®¹æ¨¡å¼)'); }
}

function manualSave() { save(false); }
setInterval(()=>save(true), 900000);
window.addEventListener('visibilitychange', ()=>{if(document.hidden)save(true)});
function setNow(id) { const n=new Date(); document.getElementById(id).value=`${pad(n.getHours())}:${pad(n.getMinutes())}`; calcTime(); autoTimeRange(); } 
function calcTime() { 
    const d=(s,e)=>{if(!s||!e)return 0; const [h1,m1]=s.split(':').map(Number); const [h2,m2]=e.split(':').map(Number); return Math.max(0,(h2*60+m2)-(h1*60+m1));}; 
    document.getElementById('wtDur').innerText=`æŒçºŒæ™‚é–“: ${d(val('#wtStart'),val('#wtEnd'))} åˆ†é˜`; 
}
function calcWater() { document.getElementById('wTotal').innerText=`ç¸½è¨ˆ: ${(Number(val('#wWork'))||0)+(Number(val('#wDay'))||0)} ML`; }
load();
</script>
</body>
</html>
